"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Temp18Estimate = void 0;
var ReferenceData_1 = require("../utils/ReferenceData");
var commonTempData_1 = require("./commonTempData");
var Temp18Estimate = /** @class */ (function () {
    function Temp18Estimate(data) {
        this.data = data;
        this.textFontSize = 3;
        this.boldTextFontSize = 3.3;
        this.headerFontSize = 5;
        this.totalSaving = 0;
        this.finalTaxPercentageTableObj = {};
        this.isTax = false;
        this.sameState = false;
        this.includeTaxPercentHeader = false;
        this.includeHsnHeader = false;
        this.includeMrpHeader = false;
    }
    Temp18Estimate.prototype.main = function () {
        return __awaiter(this, void 0, void 0, function () {
            var _a, _b;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        this.finalTaxPercentageTableObj = {};
                        _b = (_a = "\n      <style>\n      ".concat(commonTempData_1.commonTempData.invoiceHtmlTemplateCss(), "\n      .three-inch-holder *{\n        margin:0;\n        padding:0;\n      }\n      .three-inch-holder b{\n        color:#000;\n      }\n      .three-inch-holder .text-sm{\n        font-size:10px;\n      }\n      .text-3i-p{\n        font-size:10px;\n      }\n      </style>\n      <span class=\"invoice-template-main\">\n        <div \n          class=\"container-new arial three-inch-holder\"\n          style=\"width:70mm;background: white;padding: 2mm;padding-bottom: 70px;visibility: visible;-webkit-print-color-adjust: exact !important;color-adjust: exact !important;\">\n          ").concat(this.header(), "\n          ")).concat;
                        return [4 /*yield*/, this.templateBody()];
                    case 1: return [2 /*return*/, _b.apply(_a, [_c.sent(), "\n          "]).concat(this.footer(), "\n        </div>\n      </span>\n      ")];
                }
            });
        });
    };
    Temp18Estimate.prototype.header = function () {
        return "\n        ".concat(this.sellerDetails(), "\n        ").concat(this.invoiceTitle());
    };
    Temp18Estimate.prototype.footer = function () {
        var _a, _b, _c, _d, _e, _f, _g, _h;
        var domain = '';
        var includeDukanUrl = 0;
        try {
            includeDukanUrl = ((_b = (_a = this.data) === null || _a === void 0 ? void 0 : _a.settings) === null || _b === void 0 ? void 0 : _b.include3InchOnlineDukanLink) ? 1 : 0;
        }
        catch (err) {
        }
        if (((_d = (_c = this.data) === null || _c === void 0 ? void 0 : _c.onlineDukan) === null || _d === void 0 ? void 0 : _d.domain) != "") {
            domain = (_f = (_e = this.data) === null || _e === void 0 ? void 0 : _e.onlineDukan) === null || _f === void 0 ? void 0 : _f.domain;
        }
        return "<div style=\"text-align:center\">\n        <p style=\"font-size:".concat(this.textFontSize, "mm;text-align: justify;text-align-last: center;word-break:break-word\" >").concat((((_h = (_g = this.data) === null || _g === void 0 ? void 0 : _g.extra) === null || _h === void 0 ? void 0 : _h.thermalTncTemplate) || '').replace(/\n/g, '<br/>'), "</p>\n        ").concat((domain === null || domain === void 0 ? void 0 : domain.length) > 0 && includeDukanUrl ? "\n          <p style=\"font-size:".concat(this.textFontSize, "mm\">Now Order Online @</p>\n          <p style=\"font-size:").concat(this.textFontSize, "mm\">https://").concat(domain, ".ezo.digital</p>\n        ") : '', "\n        \n      </div>\n      <div class=\"row\" style=\"margin-top:20px;\"><hr/></div>");
    };
    Temp18Estimate.prototype.templateBody = function () {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2, _3, _4, _5, _6, _7, _8, _9, _10, _11, _12, _13, _14, _15, _16, _17, _18, _19, _20, _21, _22, _23, _24, _25, _26, _27, _28, _29, _30, _31, _32, _33, _34, _35, _36, _37, _38, _39, _40, _41, _42, _43, _44, _45, _46, _47, _48, _49, _50, _51, _52, _53, _54, _55, _56, _57, _58, _59, _60, _61, _62;
        return __awaiter(this, void 0, void 0, function () {
            var html, itemRowsHtml, totalQty, totalTax, isTax, totalTaxAmt, sameState, partyInfo, gstTableObj, i, invoiceItem, i, invoiceItem, el, itemNameColLength, htmlHeader, serviceChargeStr, cashdiscounttag, profileStateCode, additionalAmount, qrCodeBase64;
            return __generator(this, function (_63) {
                switch (_63.label) {
                    case 0:
                        html = '';
                        itemRowsHtml = '';
                        totalQty = 0;
                        totalTax = 0;
                        isTax = false;
                        totalTaxAmt = 0;
                        sameState = false;
                        partyInfo = ((_c = (_b = (_a = this.data) === null || _a === void 0 ? void 0 : _a.bill) === null || _b === void 0 ? void 0 : _b.partyData) === null || _c === void 0 ? void 0 : _c.profileData) || null;
                        if (partyInfo && ((partyInfo === null || partyInfo === void 0 ? void 0 : partyInfo.addressState) == ((_e = (_d = this.data) === null || _d === void 0 ? void 0 : _d.profile) === null || _e === void 0 ? void 0 : _e.addressProvience))) {
                            sameState = true;
                        }
                        else if ((!(partyInfo === null || partyInfo === void 0 ? void 0 : partyInfo.addressState) || !((_g = (_f = this.data) === null || _f === void 0 ? void 0 : _f.profile) === null || _g === void 0 ? void 0 : _g.addressProvience))) {
                            sameState = true;
                        }
                        if (((_j = (_h = this.data) === null || _h === void 0 ? void 0 : _h.bill) === null || _j === void 0 ? void 0 : _j.gstAmount) || ((_l = (_k = this.data) === null || _k === void 0 ? void 0 : _k.bill) === null || _l === void 0 ? void 0 : _l.cessAmount)) {
                            totalTaxAmt = ((_o = (_m = this.data) === null || _m === void 0 ? void 0 : _m.bill) === null || _o === void 0 ? void 0 : _o.gstAmount) + ((_q = (_p = this.data) === null || _p === void 0 ? void 0 : _p.bill) === null || _q === void 0 ? void 0 : _q.cessAmount);
                            isTax = true;
                        }
                        gstTableObj = {};
                        for (i = 0; i < ((_t = (_s = (_r = this.data) === null || _r === void 0 ? void 0 : _r.bill) === null || _s === void 0 ? void 0 : _s.billItems) === null || _t === void 0 ? void 0 : _t.length); i++) {
                            invoiceItem = (_v = (_u = this.data) === null || _u === void 0 ? void 0 : _u.bill) === null || _v === void 0 ? void 0 : _v.billItems[i];
                            if ((((_x = (_w = this.data) === null || _w === void 0 ? void 0 : _w.settings) === null || _x === void 0 ? void 0 : _x.pSetTaxMrpHsnPrintStatus) === false) && (invoiceItem === null || invoiceItem === void 0 ? void 0 : invoiceItem.taxPercentage)) {
                                this.includeTaxPercentHeader = true;
                            }
                            if (!(((_z = (_y = this.data) === null || _y === void 0 ? void 0 : _y.settings) === null || _z === void 0 ? void 0 : _z.pSetTaxMrpHsnPrintStatus) === false) && ((invoiceItem === null || invoiceItem === void 0 ? void 0 : invoiceItem.mrp) || ((_0 = invoiceItem === null || invoiceItem === void 0 ? void 0 : invoiceItem.item) === null || _0 === void 0 ? void 0 : _0.mrp))) {
                                this.includeMrpHeader = true;
                            }
                            if (!(((_2 = (_1 = this.data) === null || _1 === void 0 ? void 0 : _1.settings) === null || _2 === void 0 ? void 0 : _2.pSetTaxMrpHsnPrintStatus) === false) && (invoiceItem === null || invoiceItem === void 0 ? void 0 : invoiceItem.hsn)) {
                                this.includeHsnHeader = true;
                            }
                        }
                        for (i = 0; i < ((_5 = (_4 = (_3 = this.data) === null || _3 === void 0 ? void 0 : _3.bill) === null || _4 === void 0 ? void 0 : _4.billItems) === null || _5 === void 0 ? void 0 : _5.length); i++) {
                            invoiceItem = (_7 = (_6 = this.data) === null || _6 === void 0 ? void 0 : _6.bill) === null || _7 === void 0 ? void 0 : _7.billItems[i];
                            totalTax += invoiceItem.unitTaxAmount || 0;
                            totalQty += invoiceItem.quantity || 0;
                            el = invoiceItem;
                            gstTableObj = this.calculationForHsnTable(el, gstTableObj);
                            if (((el === null || el === void 0 ? void 0 : el.unitTaxAmount) || (el === null || el === void 0 ? void 0 : el.unitCessAmount)) && !this.isTax) {
                                this.isTax = true;
                            }
                            this.finalTaxPercentageTableObj = this.addSameTaxPercentageObjs(gstTableObj);
                            try {
                                itemRowsHtml += this.itemRow(i + 1, invoiceItem);
                            }
                            catch (err) {
                                console.error(err);
                            }
                        }
                        itemNameColLength = 16 + 7 + 6 + 6;
                        if (this.includeHsnHeader) {
                            itemNameColLength -= 7;
                        }
                        ;
                        if (this.includeTaxPercentHeader) {
                            itemNameColLength -= 6;
                        }
                        ;
                        if (this.includeMrpHeader) {
                            itemNameColLength -= 6;
                        }
                        ;
                        if (((_9 = (_8 = this.data) === null || _8 === void 0 ? void 0 : _8.bill) === null || _9 === void 0 ? void 0 : _9.totalSaving) > 0 && ((_11 = (_10 = this.data) === null || _10 === void 0 ? void 0 : _10.settings) === null || _11 === void 0 ? void 0 : _11.billSavingsAmount)) {
                            this.totalSaving = (_13 = (_12 = this.data) === null || _12 === void 0 ? void 0 : _12.bill) === null || _13 === void 0 ? void 0 : _13.totalSaving;
                        }
                        htmlHeader = "\n      <style>\n      #table-3inch td,\n      #table-3inch th,\n      #table-3inch td p,\n      #table-gst-breakup th,\n      #table-gst-breakup td\n      {\n        font-size:".concat(this.textFontSize, "mm;\n        vertical-align: top;\n      }\n      #table-gst-breakup th,\n      #table-gst-breakup td{\n        text-align:center !important;\n      }\n      </style>\n      <table id=\"table-3inch\">\n        <thead>\n          <tr>\n            <th style=\"width:5mm !important\">Sr</th>\n            ").concat(this.includeHsnHeader ? "<th style=\"width:7mm !important\">HSN</th>" : '', "\n            <th style=\"width:").concat(itemNameColLength, "mm !important;text-align:left;\">Particular</th>\n            ").concat(this.includeTaxPercentHeader ? "<th style=\"width:6mm !important\">GST</th>" : '', "\n            <th style=\"width:5mm !important\">Qt</th>\n            ").concat(this.includeMrpHeader ? "<th style=\"width:7mm !important\">MRP</th>" : '', "\n            <th style=\"width:7mm !important\">Rate</th>\n            <th style=\"width:8mm !important\">Amt</th>\n          </tr>\n        </thead>\n        <tbody>\n          ").concat(itemRowsHtml, "\n        </tbody>\n      </table>\n      \n       \n      <div class=\"row\">\n        <hr/>\n      </div>\n      ");
                        html = htmlHeader + html;
                        serviceChargeStr = "";
                        if ((_15 = (_14 = this.data) === null || _14 === void 0 ? void 0 : _14.bill) === null || _15 === void 0 ? void 0 : _15.serviceChargePercentage) {
                            serviceChargeStr = "<div class=\"col-xs-12\" style=\"text-align:right\">\n      <b style=\"font-size:".concat(this.boldTextFontSize, "mm\">Service Charge:</b> <span style=\"font-size:").concat(this.textFontSize, "mm\">(").concat((_17 = (_16 = this.data) === null || _16 === void 0 ? void 0 : _16.bill) === null || _17 === void 0 ? void 0 : _17.serviceChargePercentage, "%) ").concat((_19 = (_18 = this.data) === null || _18 === void 0 ? void 0 : _18.bill) === null || _19 === void 0 ? void 0 : _19.serviceChargeAmount, "</span>\n    </div>");
                        }
                        html += "\n    <div class=\"row\">\n      <hr/>\n    </div>\n    <div class=\"row\">\n      <hr/>\n      <div class=\"col-xs-12 text-3i-h3\" style=\"text-align:right\">\n      </div>\n      ";
                        cashdiscounttag = "";
                        if ((_21 = (_20 = this.data) === null || _20 === void 0 ? void 0 : _20.bill) === null || _21 === void 0 ? void 0 : _21.cashDiscount) {
                            cashdiscounttag +=
                                "<div class=\"col-xs-12\" style=\"text-align:right;font-size:".concat(this.boldTextFontSize, "mm\">\n      Cash Discount : ").concat(commonTempData_1.commonTempData.unitAdjuster((_23 = (_22 = this.data) === null || _22 === void 0 ? void 0 : _22.bill) === null || _23 === void 0 ? void 0 : _23.cashDiscount), " (").concat((_25 = (_24 = this.data) === null || _24 === void 0 ? void 0 : _24.bill) === null || _25 === void 0 ? void 0 : _25.cashDiscountPercentage, "%)\n      </div>");
                        }
                        html += "\n        <div class=\"row\">\n          <hr/>\n          ".concat(cashdiscounttag, "\n          <div class=\"col-xs-6\">\n          \n          </div>\n          <div class=\"col-xs-6\" style=\"text-align:right; font-size:").concat(this.textFontSize, "mm;\">\n            ").concat(((_27 = (_26 = this.data) === null || _26 === void 0 ? void 0 : _26.bill) === null || _27 === void 0 ? void 0 : _27.roundOffValue) ? "Round Off: ".concat((_29 = (_28 = this.data) === null || _28 === void 0 ? void 0 : _28.bill) === null || _29 === void 0 ? void 0 : _29.roundOffValue) : '', "\n          </div>\n          <hr/>\n          ").concat(serviceChargeStr, "\n          <div class=\"col-xs-6\" style=\"text-align:left\">\n            <b style=\"font-size:").concat(this.boldTextFontSize, "mm\">Qty:</b> <span style=\"font-size:").concat(this.textFontSize, "mm\">").concat(totalQty, "</span>\n          </div>\n          <div class=\"col-xs-9\">\n          </div>\n          <div class=\"col-xs-6\">\n          </div>\n        </div>\n        <div class=\"row\">\n          <hr/>\n          ").concat(this.includeTaxPercentHeader ? this.taxTable() : '', "\n        </div>\n        <div class=\"col-xs-12 text-3i-h3\" style=\"text-align:right\">\n        Sub Total (without tax) : ").concat(commonTempData_1.commonTempData.unitAdjuster((_31 = (_30 = this.data) === null || _30 === void 0 ? void 0 : _30.bill) === null || _31 === void 0 ? void 0 : _31.subTotalAmount), "\n        </div>\n          <hr/>\n          ");
                        if (!sameState && isTax) {
                            html += this.commonTaxAndAmtDetails('IGST', commonTempData_1.commonTempData.unitAdjuster((_33 = (_32 = this.data) === null || _32 === void 0 ? void 0 : _32.bill) === null || _33 === void 0 ? void 0 : _33.gstAmount));
                        }
                        if (sameState && isTax) {
                            profileStateCode = (_36 = (_35 = (_34 = this.data) === null || _34 === void 0 ? void 0 : _34.profile) === null || _35 === void 0 ? void 0 : _35.gstin) === null || _36 === void 0 ? void 0 : _36.substring(0, 2);
                            if (ReferenceData_1.Arrays.UTSC.indexOf(profileStateCode) != -1) {
                                html += this.commonTaxAndAmtDetails('UGST', commonTempData_1.commonTempData.unitAdjuster(((_38 = (_37 = this.data) === null || _37 === void 0 ? void 0 : _37.bill) === null || _38 === void 0 ? void 0 : _38.gstAmount) / 2));
                            }
                            else {
                                html += this.commonTaxAndAmtDetails('SGST', commonTempData_1.commonTempData.unitAdjuster(((_40 = (_39 = this.data) === null || _39 === void 0 ? void 0 : _39.bill) === null || _40 === void 0 ? void 0 : _40.gstAmount) / 2));
                            }
                        }
                        if (sameState && isTax) {
                            html += this.commonTaxAndAmtDetails('CGST', commonTempData_1.commonTempData.unitAdjuster(((_42 = (_41 = this.data) === null || _41 === void 0 ? void 0 : _41.bill) === null || _42 === void 0 ? void 0 : _42.gstAmount) / 2));
                        }
                        if ((_44 = (_43 = this.data) === null || _43 === void 0 ? void 0 : _43.bill) === null || _44 === void 0 ? void 0 : _44.cessAmount) {
                            html += this.commonTaxAndAmtDetails('CESS', commonTempData_1.commonTempData.unitAdjuster((_46 = (_45 = this.data) === null || _45 === void 0 ? void 0 : _45.bill) === null || _46 === void 0 ? void 0 : _46.cessAmount));
                        }
                        if ((_48 = (_47 = this.data) === null || _47 === void 0 ? void 0 : _47.bill) === null || _48 === void 0 ? void 0 : _48.roundOffValue) {
                            html += this.commonTaxAndAmtDetails('Round off', commonTempData_1.commonTempData.unitAdjuster((_50 = (_49 = this.data) === null || _49 === void 0 ? void 0 : _49.bill) === null || _50 === void 0 ? void 0 : _50.roundOffValue));
                        }
                        html += " \n          <div class=\"col-xs-12\" style=\"text-align:center\">\n          <hr/>\n            <b  class=\"text-3i-h2\">\n              Total : ".concat(commonTempData_1.commonTempData.unitAdjuster((_52 = (_51 = this.data) === null || _51 === void 0 ? void 0 : _51.bill) === null || _52 === void 0 ? void 0 : _52.totalAmount), "\n            </b>\n          <hr/>\n          </div>\n          ");
                        html += "\n          <div class=\"row\">\n            <hr/>\n          </div>\n            ";
                        additionalAmount = ((_54 = (_53 = this.data) === null || _53 === void 0 ? void 0 : _53.bill) === null || _54 === void 0 ? void 0 : _54.additionalAmount) || 0;
                        if (additionalAmount) {
                            html += this.commonTaxAndAmtDetails('Labour/Delivery Charges', additionalAmount);
                        }
                        if ((_56 = (_55 = this.data) === null || _55 === void 0 ? void 0 : _55.bill) === null || _56 === void 0 ? void 0 : _56.cashDiscount) {
                            html += "<div class=\"col-xs-12\" style=\"text-align:right\">\n              <b style=\"font-size:".concat(this.boldTextFontSize, "mm\">Cash Discount : </b>\n              <span style=\"font-size:").concat(this.textFontSize, "mm\">").concat(commonTempData_1.commonTempData.unitAdjuster((_58 = (_57 = this.data) === null || _57 === void 0 ? void 0 : _57.bill) === null || _58 === void 0 ? void 0 : _58.cashDiscount), " (").concat((_60 = (_59 = this.data) === null || _59 === void 0 ? void 0 : _59.bill) === null || _60 === void 0 ? void 0 : _60.cashDiscountPercentage, "%)</span>\n            </div>");
                        }
                        if (this.totalSaving > 0) {
                            html += "<div class=\"col-xs-12\" style=\"text-align:center\">\n              <b style=\"font-size:".concat(this.boldTextFontSize, "mm\">Total saving on this bill : </b>\n              <span style=\"font-size:").concat(this.textFontSize, "mm\">").concat(commonTempData_1.commonTempData.unitAdjuster(this.totalSaving), "</span>\n            </div>");
                        }
                        html += "\n          \n        </div>\n        <div class=\"row\">\n          <hr/>\n        </div>\n      ";
                        if (!((_61 = this.data) === null || _61 === void 0 ? void 0 : _61.qrPayLink)) return [3 /*break*/, 2];
                        return [4 /*yield*/, commonTempData_1.commonTempData.generateQR((_62 = this.data) === null || _62 === void 0 ? void 0 : _62.qrPayLink)];
                    case 1:
                        qrCodeBase64 = _63.sent();
                        html += "\n        <div style=\"width: 100%; margin: auto;\" class=\"m-l-neg-10 m-l-neg-2\">\n          <img style=\"width: 100%;\" src=\"".concat(qrCodeBase64, "\">\n        </div>");
                        _63.label = 2;
                    case 2: return [2 /*return*/, html];
                }
            });
        });
    };
    Temp18Estimate.prototype.commonTaxAndAmtDetails = function (title, value) {
        return "\n          <div class=\"col-xs-9\" style=\"text-align:right;font-size:".concat(this.boldTextFontSize, "mm\">").concat(title, "</div>\n          <div class=\"col-xs-3\" style=\"text-align:right;font-size:").concat(this.textFontSize, "mm\">").concat(value, "</div>\n      ");
    };
    Temp18Estimate.prototype.itemRow = function (index, invoiceItem) {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;
        return "\n        <tr>\n            <td>".concat(index, "</td>\n            ").concat(this.includeHsnHeader ? "<td>".concat((((invoiceItem === null || invoiceItem === void 0 ? void 0 : invoiceItem.hsn) || '') + ''), "</td>") : '', "\n            <td style=\"text-align:left;\">\n              <p>").concat((_a = invoiceItem === null || invoiceItem === void 0 ? void 0 : invoiceItem.item) === null || _a === void 0 ? void 0 : _a.itemName, "</p>\n              <p style=\"word-wrap: break-word;\">").concat(((((invoiceItem === null || invoiceItem === void 0 ? void 0 : invoiceItem.itemDes) && invoiceItem.itemDes != "0") ? invoiceItem.itemDes : '') + '').substring(0, 100), "</p>\n              <p style=\"word-wrap: break-word;\">").concat(((invoiceItem === null || invoiceItem === void 0 ? void 0 : invoiceItem.itemSrl) ? '(' + invoiceItem.itemSrl + ')' : ''), "</p>\n            </td>\n            ").concat(this.includeTaxPercentHeader ? "<td>".concat((invoiceItem === null || invoiceItem === void 0 ? void 0 : invoiceItem.taxPercentage) ? (invoiceItem === null || invoiceItem === void 0 ? void 0 : invoiceItem.taxPercentage) + "%" : '', "</td>") : '', "\n            <td>").concat((_c = (_b = (invoiceItem === null || invoiceItem === void 0 ? void 0 : invoiceItem.quantity)) === null || _b === void 0 ? void 0 : _b.toFixed(2)) === null || _c === void 0 ? void 0 : _c.replace(/\.00$/, ''), "</td>\n            ").concat(this.includeMrpHeader ? "<td>".concat((invoiceItem === null || invoiceItem === void 0 ? void 0 : invoiceItem.mrp) || ((_f = (_e = ((_d = invoiceItem === null || invoiceItem === void 0 ? void 0 : invoiceItem.item) === null || _d === void 0 ? void 0 : _d.mrp)) === null || _e === void 0 ? void 0 : _e.toFixed(2)) === null || _f === void 0 ? void 0 : _f.replace(/\.00$/, '')) || '', "</td>") : '', "\n            <td>").concat((_h = (_g = (invoiceItem === null || invoiceItem === void 0 ? void 0 : invoiceItem.price)) === null || _g === void 0 ? void 0 : _g.toFixed(2)) === null || _h === void 0 ? void 0 : _h.replace(/\.00$/, ''), "</td>\n            <td>").concat((_k = (_j = (invoiceItem === null || invoiceItem === void 0 ? void 0 : invoiceItem.total)) === null || _j === void 0 ? void 0 : _j.toFixed(2)) === null || _k === void 0 ? void 0 : _k.replace(/\.00$/, ''), "</td>\n        </tr>\n      \n      ");
    };
    Temp18Estimate.prototype.taxTable = function () {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2, _3, _4, _5, _6, _7, _8, _9, _10, _11, _12, _13, _14, _15, _16, _17, _18, _19, _20, _21, _22, _23, _24, _25, _26, _27, _28, _29, _30, _31, _32, _33, _34;
        var gstTableHtml = "\n      <h3 style=\"font-size:".concat(this.boldTextFontSize + 1, "mm;margin-top:5mm;\">GST Breakup</h3>");
        var taxSlabs = {};
        (_c = (_b = (_a = this.data) === null || _a === void 0 ? void 0 : _a.bill) === null || _b === void 0 ? void 0 : _b.billItems) === null || _c === void 0 ? void 0 : _c.forEach(function (el) {
            if (el === null || el === void 0 ? void 0 : el.taxPercentage) {
                if (!taxSlabs[el.taxPercentage]) {
                    taxSlabs[el.taxPercentage] = { arr: [], taxableAmount: 0, tax: 0 };
                }
                taxSlabs[el.taxPercentage].arr.push(el);
                taxSlabs[el.taxPercentage].taxableAmount += (el.price * el.quantity);
                taxSlabs[el.taxPercentage].tax += (el.itemTotalGstAmount);
            }
        });
        var partyEl = (((_f = (_e = (_d = this.data) === null || _d === void 0 ? void 0 : _d.bill) === null || _e === void 0 ? void 0 : _e.partyData) === null || _f === void 0 ? void 0 : _f.profileData) || null);
        var secondaryPartyInfo = ((_j = (_h = (_g = this.data) === null || _g === void 0 ? void 0 : _g.bill) === null || _h === void 0 ? void 0 : _h.secondaryPartyData) === null || _j === void 0 ? void 0 : _j.profileData) || null;
        if (partyEl && ((partyEl === null || partyEl === void 0 ? void 0 : partyEl.addressState) == ((_l = (_k = this.data) === null || _k === void 0 ? void 0 : _k.profile) === null || _l === void 0 ? void 0 : _l.addressProvience))) {
            this.sameState = true;
        }
        else if ((!(partyEl === null || partyEl === void 0 ? void 0 : partyEl.addressState) || !((_o = (_m = this.data) === null || _m === void 0 ? void 0 : _m.profile) === null || _o === void 0 ? void 0 : _o.addressProvience))) {
            this.sameState = true;
        }
        if (((_p = partyEl === null || partyEl === void 0 ? void 0 : partyEl.addressOneState) === null || _p === void 0 ? void 0 : _p.length)
            && ((_s = (_r = (_q = this.data) === null || _q === void 0 ? void 0 : _q.profile) === null || _r === void 0 ? void 0 : _r.addressProvience) === null || _s === void 0 ? void 0 : _s.length)
            && ((_u = (_t = this.data) === null || _t === void 0 ? void 0 : _t.profile) === null || _u === void 0 ? void 0 : _u.addressProvience) != (partyEl === null || partyEl === void 0 ? void 0 : partyEl.addressOneState)) {
            this.sameState = false;
        }
        if (((_v = secondaryPartyInfo === null || secondaryPartyInfo === void 0 ? void 0 : secondaryPartyInfo.addressOneState) === null || _v === void 0 ? void 0 : _v.length)
            && ((_y = (_x = (_w = this.data) === null || _w === void 0 ? void 0 : _w.profile) === null || _x === void 0 ? void 0 : _x.addressProvience) === null || _y === void 0 ? void 0 : _y.length)
            && ((_0 = (_z = this.data) === null || _z === void 0 ? void 0 : _z.profile) === null || _0 === void 0 ? void 0 : _0.addressProvience) != (secondaryPartyInfo === null || secondaryPartyInfo === void 0 ? void 0 : secondaryPartyInfo.addressOneState)) {
            this.sameState = false;
        }
        var stateCode = (_1 = partyEl === null || partyEl === void 0 ? void 0 : partyEl.gstNumber) === null || _1 === void 0 ? void 0 : _1.substring(0, 2);
        var profileStateCod = (_4 = (_3 = (_2 = this.data) === null || _2 === void 0 ? void 0 : _2.profile) === null || _3 === void 0 ? void 0 : _3.gstin) === null || _4 === void 0 ? void 0 : _4.substring(0, 2);
        var userState = (_6 = (_5 = this.data) === null || _5 === void 0 ? void 0 : _5.profile) === null || _6 === void 0 ? void 0 : _6.addressProvience;
        var partyState = (_8 = (_7 = this.data) === null || _7 === void 0 ? void 0 : _7.bill) === null || _8 === void 0 ? void 0 : _8.deliveryProvience;
        if (stateCode && profileStateCod) {
            this.sameState = stateCode != profileStateCod ? false : true;
        }
        else if (userState && partyState) {
            this.sameState = userState != partyState ? false : true;
        }
        if (this.sameState
            && secondaryPartyInfo
            && (secondaryPartyInfo === null || secondaryPartyInfo === void 0 ? void 0 : secondaryPartyInfo.gstNumber)
            && ((_9 = secondaryPartyInfo === null || secondaryPartyInfo === void 0 ? void 0 : secondaryPartyInfo.gstNumber) === null || _9 === void 0 ? void 0 : _9.length)
            && ((_12 = (_11 = (_10 = this.data) === null || _10 === void 0 ? void 0 : _10.profile) === null || _11 === void 0 ? void 0 : _11.gstin) === null || _12 === void 0 ? void 0 : _12.length)
            || this.sameState
                && secondaryPartyInfo
                && ((_15 = (_14 = (_13 = this.data) === null || _13 === void 0 ? void 0 : _13.bill) === null || _14 === void 0 ? void 0 : _14.deliveryProvience) === null || _15 === void 0 ? void 0 : _15.length)
                && ((_18 = (_17 = (_16 = this.data) === null || _16 === void 0 ? void 0 : _16.profile) === null || _17 === void 0 ? void 0 : _17.addressProvience) === null || _18 === void 0 ? void 0 : _18.length)) {
            var secondaryStateCode = (_19 = secondaryPartyInfo === null || secondaryPartyInfo === void 0 ? void 0 : secondaryPartyInfo.gstNumber) === null || _19 === void 0 ? void 0 : _19.substring(0, 2);
            if (secondaryStateCode && profileStateCod) {
                this.sameState = secondaryStateCode != profileStateCod ? false : true;
            }
            else if (userState && partyState) {
                this.sameState = userState != partyState ? false : true;
            }
        }
        var html = gstTableHtml;
        var gstStr = 'SGST';
        var profileStateCode = (_22 = (_21 = (_20 = this.data) === null || _20 === void 0 ? void 0 : _20.profile) === null || _21 === void 0 ? void 0 : _21.gstin) === null || _22 === void 0 ? void 0 : _22.substring(0, 2);
        if (ReferenceData_1.Arrays.UTSC.indexOf(profileStateCode) != -1) {
            gstStr = 'UGST';
        }
        else {
            gstStr = 'SGST';
        }
        html += "\n      <table id=\"table-gst-breakup\" style=\"width: 100%; text-align: center;table-layout: fixed;\">\n      <thead class=\"no-b-btm\" style=\"-webkit-print-color-adjust: exact !important;color-adjust: exact !important;\">\n        <tr>\n        \n        <td>Gross</td>\n        <td>\n          ".concat((!this.sameState && this.isTax) ? 'IGST' : gstStr, "\n        </td>\n        <td>\n          ").concat((!this.sameState && this.isTax) ? 'IGST Amt' : "".concat(gstStr, " Amt"), "\n        </td>");
        if (this.sameState && this.isTax) {
            html += "<td>CGST</td><td>CGST Amt</td>";
        }
        html += "\n        </tr>";
        html += "\n      </thead>\n      <tbody>";
        var isTaxSlab = false;
        for (var k in taxSlabs) {
            isTaxSlab = true;
            var cgst = false;
            if (this.sameState && this.isTax) {
                cgst = true;
            }
            html += "<tr>\n          <td>".concat(taxSlabs[k].taxableAmount, "</td>\n          <td>").concat(cgst ? (_24 = (_23 = (Number(k) / 2)) === null || _23 === void 0 ? void 0 : _23.toFixed(2)) === null || _24 === void 0 ? void 0 : _24.replace(/\.00$/, '') : (_26 = (_25 = (Number(k))) === null || _25 === void 0 ? void 0 : _25.toFixed(2)) === null || _26 === void 0 ? void 0 : _26.replace(/\.00$/, ''), "%</td>\n          <td>").concat(cgst ? (_28 = (_27 = (taxSlabs[k].tax / 2)) === null || _27 === void 0 ? void 0 : _27.toFixed(2)) === null || _28 === void 0 ? void 0 : _28.replace(/\.00$/, '') : (_30 = (_29 = (taxSlabs[k].tax)) === null || _29 === void 0 ? void 0 : _29.toFixed(2)) === null || _30 === void 0 ? void 0 : _30.replace(/\.00$/, ''), "</td>\n          ").concat(cgst ? "\n            <td>".concat((_32 = (_31 = (Number(k) / 2)) === null || _31 === void 0 ? void 0 : _31.toFixed(2)) === null || _32 === void 0 ? void 0 : _32.replace(/\.00$/, ''), "%</td>\n            <td>").concat((_34 = (_33 = (taxSlabs[k].tax / 2)) === null || _33 === void 0 ? void 0 : _33.toFixed(2)) === null || _34 === void 0 ? void 0 : _34.replace(/\.00$/, ''), "</td>\n          ") : '', "\n          \n        </tr>");
        }
        html += "\n      </tbody>\n      </table>\n      ";
        return isTaxSlab ? html : '';
    };
    Temp18Estimate.prototype.sellerDetails = function () {
        var _a, _b, _c, _d, _e;
        var html = "";
        if ((_b = (_a = this.data) === null || _a === void 0 ? void 0 : _a.profile) === null || _b === void 0 ? void 0 : _b.logoLink) {
            html += "\n      <div style=\"display: flow-root;width: 100%;\">\n        <img src=\"".concat((_d = (_c = this.data) === null || _c === void 0 ? void 0 : _c.profile) === null || _d === void 0 ? void 0 : _d.logoLink, "\" style=\"display: block;margin:auto;width:100px;height: 100px; max-width: none !important;\">\n      </div>\n      ");
        }
        var sellerProfileData = (_e = this.data) === null || _e === void 0 ? void 0 : _e.profile;
        html += "<div style=\"text-align:center\">\n          <h3 style=\"font-size:".concat(this.headerFontSize, "mm;\">").concat((sellerProfileData === null || sellerProfileData === void 0 ? void 0 : sellerProfileData.legalName) || '', "</h3>\n          <p style=\"font-size:").concat(this.textFontSize, "mm\">").concat((sellerProfileData === null || sellerProfileData === void 0 ? void 0 : sellerProfileData.addressLine1) || '').concat((sellerProfileData === null || sellerProfileData === void 0 ? void 0 : sellerProfileData.addressProvience) ? ', ' + (sellerProfileData === null || sellerProfileData === void 0 ? void 0 : sellerProfileData.addressProvience) : '').concat((sellerProfileData === null || sellerProfileData === void 0 ? void 0 : sellerProfileData.addressPostalCode) ? ', ' + (sellerProfileData === null || sellerProfileData === void 0 ? void 0 : sellerProfileData.addressPostalCode) : '', "</p>\n          <p style=\"font-size:").concat(this.textFontSize, "mm\">").concat(((sellerProfileData === null || sellerProfileData === void 0 ? void 0 : sellerProfileData.contactPersonPhone) && (sellerProfileData === null || sellerProfileData === void 0 ? void 0 : sellerProfileData.contactPersonPhone) != '0') ? 'Phone: ' + (sellerProfileData === null || sellerProfileData === void 0 ? void 0 : sellerProfileData.contactPersonPhone) : '', "</p>\n          <p style=\"font-size:").concat(this.textFontSize, "mm\">").concat((sellerProfileData === null || sellerProfileData === void 0 ? void 0 : sellerProfileData.contactPersonEmail) ? 'Email: ' + (sellerProfileData === null || sellerProfileData === void 0 ? void 0 : sellerProfileData.contactPersonEmail) : '', "</p>\n          <p style=\"font-size:").concat(this.textFontSize, "mm\" style=\"word-break:break-word\">").concat((sellerProfileData === null || sellerProfileData === void 0 ? void 0 : sellerProfileData.gstin) ? 'GST Number : ' + (sellerProfileData === null || sellerProfileData === void 0 ? void 0 : sellerProfileData.gstin) : '', "</p>\n          <p style=\"font-size:").concat(this.textFontSize, "mm\" style=\"word-break:break-word\">").concat((sellerProfileData === null || sellerProfileData === void 0 ? void 0 : sellerProfileData.fssaiNumber) ? 'FSSAI No. : ' + (sellerProfileData === null || sellerProfileData === void 0 ? void 0 : sellerProfileData.fssaiNumber) : '', "</p>\n          <p style=\"font-size:").concat(this.textFontSize, "mm\" style=\"word-break:break-word\">").concat((sellerProfileData === null || sellerProfileData === void 0 ? void 0 : sellerProfileData.licenseNumber) ? 'License No. : ' + (sellerProfileData === null || sellerProfileData === void 0 ? void 0 : sellerProfileData.licenseNumber) : '', "</p>\n        </div>");
        return html;
    };
    Temp18Estimate.prototype.invoiceTitle = function () {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2, _3, _4, _5, _6, _7, _8, _9, _10, _11, _12, _13, _14, _15, _16, _17, _18;
        var party = ((_c = (_b = (_a = this.data) === null || _a === void 0 ? void 0 : _a.bill) === null || _b === void 0 ? void 0 : _b.partyData) === null || _c === void 0 ? void 0 : _c.profileData) || null;
        var isBillDateDiff = commonTempData_1.commonTempData.isBillDateDiff((_e = (_d = this.data) === null || _d === void 0 ? void 0 : _d.bill) === null || _e === void 0 ? void 0 : _e.createdStamp, (_g = (_f = this.data) === null || _f === void 0 ? void 0 : _f.bill) === null || _g === void 0 ? void 0 : _g.billDateStamp);
        var html = "\n        <div class=\"row\">\n          <hr/>\n          <h4 style=\"font-size:".concat(this.headerFontSize - 1, "mm\"  class=\"text-center\">").concat(commonTempData_1.commonTempData.getInvoiceTitle(this.data) || '', "</h4>\n          <hr/>\n          <div class=\"col-xs-12\">\n           <b style=\"font-size:").concat(this.boldTextFontSize, "mm\">Bill No :</b> <span style=\"font-size:").concat(this.boldTextFontSize, "mm\">").concat(((_j = (_h = this.data) === null || _h === void 0 ? void 0 : _h.bill) === null || _j === void 0 ? void 0 : _j.billNo) || '', "</span>\n          </div>\n          <div class=\"col-xs-12\">\n           <b style=\"font-size:").concat(this.boldTextFontSize, "mm\">Created on :</b> <span style=\"font-size:").concat(this.boldTextFontSize, "mm\">").concat(commonTempData_1.commonTempData.dateToDDMMYYYHHMMAP((_l = (_k = this.data) === null || _k === void 0 ? void 0 : _k.bill) === null || _l === void 0 ? void 0 : _l.createdStamp), "</span>\n          </div>\n          ").concat(isBillDateDiff ? "\n            <div class=\"col-xs-12\">\n            <b style=\"font-size:".concat(this.boldTextFontSize, "mm\">Date :</b> <span style=\"font-size:").concat(this.boldTextFontSize, "mm\">").concat(commonTempData_1.commonTempData.dateToDDMMYYY((_o = (_m = this.data) === null || _m === void 0 ? void 0 : _m.bill) === null || _o === void 0 ? void 0 : _o.billDateStamp), "</span>\n            </div>\n          ") : '', "\n          <div class=\"col-xs-12\">\n            ").concat(((_q = (_p = this.data) === null || _p === void 0 ? void 0 : _p.bill) === null || _q === void 0 ? void 0 : _q.dueDateStamp) && ((_s = (_r = this.data) === null || _r === void 0 ? void 0 : _r.bill) === null || _s === void 0 ? void 0 : _s.dueDateStamp) > 0 ? "<b style=\"font-size:".concat(this.boldTextFontSize, "mm\">Due Date:</b> <span style=\"font-size:").concat(this.boldTextFontSize, "mm\">").concat(commonTempData_1.commonTempData.dateToDDMMYYY((_u = (_t = this.data) === null || _t === void 0 ? void 0 : _t.bill) === null || _u === void 0 ? void 0 : _u.dueDateStamp), "</span>") : '', "\n          </div>\n        </div>\n        <div class=\"row\">\n          <hr/>\n          <div class=\"col-xs-12\">\n            <b style=\"font-size:").concat(this.boldTextFontSize, "mm\">Bill To :</b> \n            <span style=\"font-size:").concat(this.textFontSize, "mm\">").concat(party === null || party === void 0 ? void 0 : party.contactPersonName).concat((party === null || party === void 0 ? void 0 : party.contactPersonPhone) ? ' <hr/> ' + (party === null || party === void 0 ? void 0 : party.contactPersonPhone) : '', "</span>\n            ").concat(((_w = (_v = this.data) === null || _v === void 0 ? void 0 : _v.bill) === null || _w === void 0 ? void 0 : _w.isPartyDeleted) ? "<hr/><p class='text-danger'>Party Has Been Deleted</p>" : "", "\n            ").concat((party === null || party === void 0 ? void 0 : party.gstNumber) ? "<hr/>" + (party === null || party === void 0 ? void 0 : party.gstNumber) + "<hr/>" : '', "\n          </div>\n          \n        </div>");
        if (party === null || party === void 0 ? void 0 : party.addressLine1) {
            html += "\n          <div class=\"row\">\n          <div class=\"col-xs-12\">\n            <b style=\"font-size:".concat(this.boldTextFontSize, "mm\">Address : </b> <span style=\"font-size:").concat(this.textFontSize, "mm\">").concat((party === null || party === void 0 ? void 0 : party.addressLine1) ? party === null || party === void 0 ? void 0 : party.addressLine1 : '', " ").concat((party === null || party === void 0 ? void 0 : party.addressState) ? ', ' + (party === null || party === void 0 ? void 0 : party.addressState) : '').concat((party === null || party === void 0 ? void 0 : party.addressPincode) ? ', ' + (party === null || party === void 0 ? void 0 : party.addressPincode) : '', "</span>\n          </div>\n          </div>");
        }
        if ((_0 = (_z = (_y = (_x = this.data) === null || _x === void 0 ? void 0 : _x.bill) === null || _y === void 0 ? void 0 : _y.secondaryPartyData) === null || _z === void 0 ? void 0 : _z.profileData) === null || _0 === void 0 ? void 0 : _0.contactPersonName) {
            var secondaryParty = (_3 = (_2 = (_1 = this.data) === null || _1 === void 0 ? void 0 : _1.bill) === null || _2 === void 0 ? void 0 : _2.secondaryPartyData) === null || _3 === void 0 ? void 0 : _3.profileData;
            html += "\n          <div class=\"row\">\n            <div class=\"col-xs-12\">\n            <b style=\"font-size:".concat(this.boldTextFontSize, "mm\">Bill To :</b> \n            <span style=\"font-size:").concat(this.textFontSize, "mm\">\n              ").concat(secondaryParty === null || secondaryParty === void 0 ? void 0 : secondaryParty.contactPersonName).concat((secondaryParty === null || secondaryParty === void 0 ? void 0 : secondaryParty.contactPersonPhone) ? ' <hr/> ' + (secondaryParty === null || secondaryParty === void 0 ? void 0 : secondaryParty.contactPersonPhone) : '', "\n              ").concat(((_7 = (_6 = (_5 = (_4 = this.data) === null || _4 === void 0 ? void 0 : _4.bill) === null || _5 === void 0 ? void 0 : _5.secondaryPartyData) === null || _6 === void 0 ? void 0 : _6.profileData) === null || _7 === void 0 ? void 0 : _7.gstNumber) ? "<hr/>" + ((_11 = (_10 = (_9 = (_8 = this.data) === null || _8 === void 0 ? void 0 : _8.bill) === null || _9 === void 0 ? void 0 : _9.secondaryPartyData) === null || _10 === void 0 ? void 0 : _10.profileData) === null || _11 === void 0 ? void 0 : _11.gstNumber) + "<hr/>" : '', "\n            </span>\n            </div>\n          </div>\n          ");
        }
        if ((_15 = (_14 = (_13 = (_12 = this.data) === null || _12 === void 0 ? void 0 : _12.bill) === null || _13 === void 0 ? void 0 : _13.secondaryPartyData) === null || _14 === void 0 ? void 0 : _14.profileData) === null || _15 === void 0 ? void 0 : _15.addressLine1) {
            var secondaryParty = (_18 = (_17 = (_16 = this.data) === null || _16 === void 0 ? void 0 : _16.bill) === null || _17 === void 0 ? void 0 : _17.secondaryPartyData) === null || _18 === void 0 ? void 0 : _18.profileData;
            html += "\n          <div class=\"row\">\n            <div class=\"col-xs-12\">\n              <b style=\"font-size:".concat(this.boldTextFontSize, "mm\">Address : </b> <span style=\"font-size:").concat(this.textFontSize, "mm\">").concat((secondaryParty === null || secondaryParty === void 0 ? void 0 : secondaryParty.addressLine1) ? secondaryParty === null || secondaryParty === void 0 ? void 0 : secondaryParty.addressLine1 : '', " ").concat((secondaryParty === null || secondaryParty === void 0 ? void 0 : secondaryParty.addressState) ? ', ' + (secondaryParty === null || secondaryParty === void 0 ? void 0 : secondaryParty.addressState) : '').concat((secondaryParty === null || secondaryParty === void 0 ? void 0 : secondaryParty.addressPincode) ? ', ' + (secondaryParty === null || secondaryParty === void 0 ? void 0 : secondaryParty.addressPincode) : '', "</span>\n            </div>\n          </div>\n          ");
        }
        html += "\n        <div class=\"row\">\n          <hr/>\n        </div>\n      ";
        return html;
    };
    Temp18Estimate.prototype.addSameTaxPercentageObjs = function (mainObj) {
        var _a, _b;
        var sanitizedObj = {};
        var _loop_1 = function (key) {
            var holder = {};
            mainObj[key].forEach(function (d) {
                if ((d === null || d === void 0 ? void 0 : d.taxPercentage) != 0) {
                    if (holder.hasOwnProperty(d === null || d === void 0 ? void 0 : d.taxPercentage)) {
                        holder[d === null || d === void 0 ? void 0 : d.taxPercentage] = {
                            "taxAmount": (holder[d === null || d === void 0 ? void 0 : d.taxPercentage].taxAmount + (d === null || d === void 0 ? void 0 : d.taxAmount)),
                            "itemPrice": (holder[d === null || d === void 0 ? void 0 : d.taxPercentage].itemPrice + ((d === null || d === void 0 ? void 0 : d.itemPrice) * (d === null || d === void 0 ? void 0 : d.quantity)) - ((d === null || d === void 0 ? void 0 : d.isIncTax) ? d === null || d === void 0 ? void 0 : d.taxAmount : 0) - (d.discount || 0))
                        };
                    }
                    else {
                        holder[d === null || d === void 0 ? void 0 : d.taxPercentage] = {
                            "taxAmount": d === null || d === void 0 ? void 0 : d.taxAmount,
                            "itemPrice": ((d === null || d === void 0 ? void 0 : d.itemPrice) * (d === null || d === void 0 ? void 0 : d.quantity)) - ((d === null || d === void 0 ? void 0 : d.isIncTax) ? d === null || d === void 0 ? void 0 : d.taxAmount : 0) - (d.discount || 0)
                        };
                    }
                }
            });
            var array = [];
            for (var prop in holder) {
                array.push({ taxPercentage: prop, taxAmount: (_a = holder[prop]) === null || _a === void 0 ? void 0 : _a.taxAmount, taxableValue: (_b = holder[prop]) === null || _b === void 0 ? void 0 : _b.itemPrice });
            }
            if (array.length) {
                sanitizedObj[key] = array;
            }
        };
        for (var key in mainObj) {
            _loop_1(key);
        }
        return sanitizedObj;
    };
    Temp18Estimate.prototype.commonHsnTableCode = function (el) {
        var isIncTax = false;
        if (el === null || el === void 0 ? void 0 : el.spIncTax) {
            isIncTax = true;
        }
        return {
            'taxAmount': (el === null || el === void 0 ? void 0 : el.itemTotalTaxAmount) || 0,
            'itemPrice': el === null || el === void 0 ? void 0 : el.price,
            'taxPercentage': (el === null || el === void 0 ? void 0 : el.taxPercentage) || 0,
            'quantity': (el === null || el === void 0 ? void 0 : el.quantity) || 1,
            'isIncTax': isIncTax,
            'discount': (el === null || el === void 0 ? void 0 : el.discount) || 0
        };
    };
    Temp18Estimate.prototype.calculationForHsnTable = function (el, gstTableObj) {
        if (el === null || el === void 0 ? void 0 : el.taxPercentage) {
            if (gstTableObj[el === null || el === void 0 ? void 0 : el.taxPercentage]) {
                gstTableObj[el === null || el === void 0 ? void 0 : el.taxPercentage].push(__assign({}, this.commonHsnTableCode(el)));
            }
            else {
                gstTableObj[el === null || el === void 0 ? void 0 : el.taxPercentage] = [__assign({}, this.commonHsnTableCode(el))];
            }
        }
        return gstTableObj;
    };
    Temp18Estimate.prototype.hsnSacTable = function () {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2, _3, _4, _5, _6, _7, _8, _9, _10, _11, _12, _13, _14, _15, _16, _17, _18, _19;
        if (!Object.keys(this.finalTaxPercentageTableObj).length) {
            return '';
        }
        var partyEl = (((_c = (_b = (_a = this.data) === null || _a === void 0 ? void 0 : _a.bill) === null || _b === void 0 ? void 0 : _b.partyData) === null || _c === void 0 ? void 0 : _c.profileData) || null);
        var secondaryPartyInfo = ((_f = (_e = (_d = this.data) === null || _d === void 0 ? void 0 : _d.bill) === null || _e === void 0 ? void 0 : _e.secondaryPartyData) === null || _f === void 0 ? void 0 : _f.profileData) || null;
        if (partyEl && ((partyEl === null || partyEl === void 0 ? void 0 : partyEl.addressState) == ((_h = (_g = this.data) === null || _g === void 0 ? void 0 : _g.profile) === null || _h === void 0 ? void 0 : _h.addressProvience))) {
            this.sameState = true;
        }
        else if ((!(partyEl === null || partyEl === void 0 ? void 0 : partyEl.addressState) || !((_k = (_j = this.data) === null || _j === void 0 ? void 0 : _j.profile) === null || _k === void 0 ? void 0 : _k.addressProvience))) {
            this.sameState = true;
        }
        if (((_l = partyEl === null || partyEl === void 0 ? void 0 : partyEl.addressOneState) === null || _l === void 0 ? void 0 : _l.length)
            && ((_p = (_o = (_m = this.data) === null || _m === void 0 ? void 0 : _m.profile) === null || _o === void 0 ? void 0 : _o.addressProvience) === null || _p === void 0 ? void 0 : _p.length)
            && ((_r = (_q = this.data) === null || _q === void 0 ? void 0 : _q.profile) === null || _r === void 0 ? void 0 : _r.addressProvience) != (partyEl === null || partyEl === void 0 ? void 0 : partyEl.addressOneState)) {
            this.sameState = false;
        }
        if (((_s = secondaryPartyInfo === null || secondaryPartyInfo === void 0 ? void 0 : secondaryPartyInfo.addressOneState) === null || _s === void 0 ? void 0 : _s.length)
            && ((_v = (_u = (_t = this.data) === null || _t === void 0 ? void 0 : _t.profile) === null || _u === void 0 ? void 0 : _u.addressProvience) === null || _v === void 0 ? void 0 : _v.length)
            && ((_x = (_w = this.data) === null || _w === void 0 ? void 0 : _w.profile) === null || _x === void 0 ? void 0 : _x.addressProvience) != (secondaryPartyInfo === null || secondaryPartyInfo === void 0 ? void 0 : secondaryPartyInfo.addressOneState)) {
            this.sameState = false;
        }
        var stateCode = (_y = partyEl === null || partyEl === void 0 ? void 0 : partyEl.gstNumber) === null || _y === void 0 ? void 0 : _y.substring(0, 2);
        var profileStateCod = (_1 = (_0 = (_z = this.data) === null || _z === void 0 ? void 0 : _z.profile) === null || _0 === void 0 ? void 0 : _0.gstin) === null || _1 === void 0 ? void 0 : _1.substring(0, 2);
        var userState = (_3 = (_2 = this.data) === null || _2 === void 0 ? void 0 : _2.profile) === null || _3 === void 0 ? void 0 : _3.addressProvience;
        var partyState = (_5 = (_4 = this.data) === null || _4 === void 0 ? void 0 : _4.bill) === null || _5 === void 0 ? void 0 : _5.deliveryProvience;
        if (stateCode && profileStateCod) {
            this.sameState = stateCode != profileStateCod ? false : true;
        }
        else if (userState && partyState) {
            this.sameState = userState != partyState ? false : true;
        }
        if (this.sameState
            && secondaryPartyInfo
            && (secondaryPartyInfo === null || secondaryPartyInfo === void 0 ? void 0 : secondaryPartyInfo.gstNumber)
            && ((_6 = secondaryPartyInfo === null || secondaryPartyInfo === void 0 ? void 0 : secondaryPartyInfo.gstNumber) === null || _6 === void 0 ? void 0 : _6.length)
            && ((_9 = (_8 = (_7 = this.data) === null || _7 === void 0 ? void 0 : _7.profile) === null || _8 === void 0 ? void 0 : _8.gstin) === null || _9 === void 0 ? void 0 : _9.length)
            || this.sameState
                && secondaryPartyInfo
                && ((_12 = (_11 = (_10 = this.data) === null || _10 === void 0 ? void 0 : _10.bill) === null || _11 === void 0 ? void 0 : _11.deliveryProvience) === null || _12 === void 0 ? void 0 : _12.length)
                && ((_15 = (_14 = (_13 = this.data) === null || _13 === void 0 ? void 0 : _13.profile) === null || _14 === void 0 ? void 0 : _14.addressProvience) === null || _15 === void 0 ? void 0 : _15.length)) {
            var secondaryStateCode = (_16 = secondaryPartyInfo === null || secondaryPartyInfo === void 0 ? void 0 : secondaryPartyInfo.gstNumber) === null || _16 === void 0 ? void 0 : _16.substring(0, 2);
            if (secondaryStateCode && profileStateCod) {
                this.sameState = secondaryStateCode != profileStateCod ? false : true;
            }
            else if (userState && partyState) {
                this.sameState = userState != partyState ? false : true;
            }
        }
        var html = '';
        var gstStr = 'SGST';
        var profileStateCode = (_19 = (_18 = (_17 = this.data) === null || _17 === void 0 ? void 0 : _17.profile) === null || _18 === void 0 ? void 0 : _18.gstin) === null || _19 === void 0 ? void 0 : _19.substring(0, 2);
        if (ReferenceData_1.Arrays.UTSC.indexOf(profileStateCode) != -1) {
            gstStr = 'UGST';
        }
        else {
            gstStr = 'SGST';
        }
        html += "\n      <table id=\"table-gst-breakup\" style=\"width: 100%; text-align: center;table-layout: fixed;\">\n      <thead class=\"no-b-btm\" style=\"-webkit-print-color-adjust: exact !important;color-adjust: exact !important;\">\n        <tr>\n        \n        <td>Gross</td>\n        <td>\n          ".concat((!this.sameState && this.isTax) ? 'IGST' : "".concat(gstStr), "\n        </td>\n        <td>\n          ").concat((!this.sameState && this.isTax) ? 'IGST Amt' : "".concat(gstStr, " Amt"), "\n        </td>");
        if (this.sameState && this.isTax) {
            html += "<td>CGST</td><td>CGST Amt</td>";
        }
        html += "\n        </tr>\n        <tr>";
        html += "\n      </thead>\n      <tbody>";
        for (var key in this.finalTaxPercentageTableObj) {
            if (this.finalTaxPercentageTableObj[key]) {
                html += this.gstSacRow(key, this.finalTaxPercentageTableObj[key]);
            }
        }
        html += "\n      </tbody>\n      </table>\n      ";
        return html;
    };
    Temp18Estimate.prototype.gstSacRow = function (taxPercentage, gstData) {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;
        var html = '';
        for (var i = 0; i < gstData.length; i++) {
            var element = gstData[i];
            html += "\n          <tr>\n          \n          <td>\n            ".concat(commonTempData_1.commonTempData.unitAdjuster((element === null || element === void 0 ? void 0 : element.taxableValue) || 0), "</td>\n          <td>\n          ").concat((!this.sameState && this.isTax) ? (_b = (_a = (+(element === null || element === void 0 ? void 0 : element.taxPercentage))) === null || _a === void 0 ? void 0 : _a.toFixed(2)) === null || _b === void 0 ? void 0 : _b.replace(/\.00$/, '') : (_d = (_c = (+(element === null || element === void 0 ? void 0 : element.taxPercentage) / 2)) === null || _c === void 0 ? void 0 : _c.toFixed(2)) === null || _d === void 0 ? void 0 : _d.replace(/\.00$/, ''), "%\n          </td>\n          <td>\n          ").concat((!this.sameState && this.isTax) ? (_f = (_e = (element === null || element === void 0 ? void 0 : element.taxAmount)) === null || _e === void 0 ? void 0 : _e.toFixed(2)) === null || _f === void 0 ? void 0 : _f.replace(/\.00$/, '') : (_h = (_g = ((element === null || element === void 0 ? void 0 : element.taxAmount) / 2)) === null || _g === void 0 ? void 0 : _g.toFixed(2)) === null || _h === void 0 ? void 0 : _h.replace(/\.00$/, ''), "</td>\n          ");
            if (this.sameState && this.isTax) {
                html += "<td>\n            ".concat((_k = (_j = (+(element === null || element === void 0 ? void 0 : element.taxPercentage) / 2)) === null || _j === void 0 ? void 0 : _j.toFixed(2)) === null || _k === void 0 ? void 0 : _k.replace(/\.00$/, ''), "%\n            </td>\n            <td>\n            ").concat((_m = (_l = ((element === null || element === void 0 ? void 0 : element.taxAmount) / 2)) === null || _l === void 0 ? void 0 : _l.toFixed(2)) === null || _m === void 0 ? void 0 : _m.replace(/\.00$/, ''), "</td>\n            ");
            }
            html += "\n            </tr>\n            ";
        }
        return html;
    };
    return Temp18Estimate;
}());
exports.Temp18Estimate = Temp18Estimate;
//# sourceMappingURL=temp18-estimate.js.map